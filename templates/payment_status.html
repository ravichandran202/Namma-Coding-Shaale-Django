{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}
{% if status == 'COMPLETED' %}Payment Successful
{% elif status == 'PENDING' %}Payment Pending
{% elif status == 'FAILED' %}Payment Failed
{% else %}Payment Status{% endif %} - ‡≤®‡≤Æ‡≥ç‡≤Æ CODING ‡≤∂‡≤æ‡≤≤‡≥Ü
{% endblock %}

{% block body_class %}
class="
{% if status == 'COMPLETED' %}success-page
{% elif status == 'PENDING' %}pending-page
{% elif status == 'FAILED' %}failed-page
{% else %}error-page{% endif %}"
{% endblock %}

{% block extra_css %}
<style>
  /* Status-specific body backgrounds (kept minimal for colored top bar) */
  body.success-page .status-card::before {
    background: var(--success) !important;
  }

  body.pending-page .status-card::before {
    background: var(--warning) !important;
  }

  body.failed-page .status-card::before {
    background: var(--danger) !important;
  }

  body.error-page .status-card::before {
    background: var(--gray) !important;
  }

  /* Main Container */
  .status-container {
    max-width: 600px;
    width: 100%;
    margin: 3rem auto;
    position: relative;
    z-index: 1;
    padding: 0 1rem;
  }

  /* Status Card */
  .status-card {
    background: white;
    border-radius: 24px;
    padding: 3rem 2rem;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
    animation: slideUp 0.8s ease-out;
    position: relative;
    overflow: hidden;
  }

  .status-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
  }

  /* Status Icon */
  .status-icon-wrapper {
    width: 120px;
    height: 120px;
    margin: 0 auto 2rem;
    position: relative;
  }

  .status-icon {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3.5rem;
    color: white;
    animation: iconPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.3s both;
    position: relative;
    z-index: 1;
  }

  .success-page .status-icon {
    background: linear-gradient(135deg, var(--success), #059669);
    box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4);
  }

  .pending-page .status-icon {
    background: linear-gradient(135deg, var(--warning), #d97706);
    box-shadow: 0 10px 40px rgba(245, 158, 11, 0.4);
    animation: pulse 2s ease-in-out infinite;
  }

  .failed-page .status-icon {
    background: linear-gradient(135deg, var(--danger), #dc2626);
    box-shadow: 0 10px 40px rgba(239, 68, 68, 0.4);
  }

  .error-page .status-icon {
    background: linear-gradient(135deg, var(--gray), #475569);
    box-shadow: 0 10px 40px rgba(100, 116, 139, 0.4);
  }

  /* Ring Animation for Success */
  .icon-ring {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 3px solid;
    border-radius: 50%;
    animation: ringExpand 1.5s ease-out;
  }

  .success-page .icon-ring {
    border-color: var(--success);
  }

  @keyframes iconPop {
    0% {
      transform: scale(0);
      opacity: 0;
    }

    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  @keyframes ringExpand {
    0% {
      transform: scale(1);
      opacity: 1;
    }

    100% {
      transform: scale(1.4);
      opacity: 0;
    }
  }

  @keyframes pulse {

    0%,
    100% {
      transform: scale(1);
    }

    50% {
      transform: scale(1.05);
    }
  }

  /* Text Content */
  .status-title {
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-size: 2rem;
    font-weight: 800;
    color: var(--dark);
    margin-bottom: 1rem;
    animation: fadeIn 0.8s ease-out 0.4s both;
  }

  .status-message {
    font-size: 1.1rem;
    color: var(--gray);
    margin-bottom: 2rem;
    line-height: 1.6;
    animation: fadeIn 0.8s ease-out 0.5s both;
  }

  /* Order Details */
  .order-details {
    background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(16, 185, 129, 0.05));
    border-radius: 16px;
    padding: 1.5rem;
    margin: 2rem 0;
    text-align: left;
    animation: fadeIn 0.8s ease-out 0.6s both;
  }

  .detail-row {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    font-size: 0.95rem;
  }

  .detail-row:last-child {
    border-bottom: none;
  }

  .detail-label {
    color: var(--gray);
    font-weight: 500;
  }

  .detail-value {
    font-weight: 600;
    color: var(--dark);
  }

  /* Buttons */
  .action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    animation: fadeIn 0.8s ease-out 0.7s both;
  }

  .btn-primary-custom {
    flex: 1;
    padding: 1rem 2rem;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg, var(--primary), #7c3aed);
    color: white;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .btn-primary-custom:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
    color: white;
  }

  .btn-secondary-custom {
    flex: 1;
    padding: 1rem 2rem;
    border-radius: 12px;
    border: 2px solid var(--gray);
    background: white;
    color: var(--dark);
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .btn-secondary-custom:hover {
    background: var(--dark);
    border-color: var(--dark);
    color: white;
    transform: translateY(-2px);
  }

  /* Success specific */
  .success-page .btn-primary-custom {
    background: linear-gradient(135deg, var(--success), #059669);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
  }

  .success-page .btn-primary-custom:hover {
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
  }

  /* Warning for pending */
  .warning-box {
    background: rgba(245, 158, 11, 0.1);
    border-left: 4px solid var(--warning);
    border-radius: 12px;
    padding: 1.25rem;
    margin: 1.5rem 0;
    text-align: left;
  }

  .warning-box h4 {
    font-size: 1rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .warning-box p {
    margin: 0;
    color: var(--gray);
    font-size: 0.9rem;
    line-height: 1.6;
  }

  /* Animations */
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(50px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  /* Confetti for success */
  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background: var(--success);
    position: absolute;
    animation: confetti-fall 3s ease-out forwards;
  }

  @keyframes confetti-fall {
    to {
      transform: translateY(100vh) rotate(360deg);
      opacity: 0;
    }
  }

  /* Responsive */
  @media (max-width: 575px) {
    .status-card {
      padding: 2rem 1.5rem;
      border-radius: 20px;
    }

    .status-title {
      font-size: 1.5rem;
    }

    .status-message {
      font-size: 1rem;
    }

    .status-icon-wrapper {
      width: 100px;
      height: 100px;
    }

    .status-icon {
      font-size: 2.5rem;
    }

    .action-buttons {
      flex-direction: column;
    }

    .btn-primary-custom,
    .btn-secondary-custom {
      width: 100%;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="status-container">
  <div class="status-card">

    <!-- SUCCESS STATE -->
    {% if status == 'COMPLETED' %}
    <div class="status-icon-wrapper">
      <div class="status-icon">
        <i class="fas fa-check"></i>
      </div>
      <div class="icon-ring"></div>
      <div class="icon-ring" style="animation-delay: 0.2s;"></div>
    </div>

    <h1 class="status-title">Payment Successful! üéâ</h1>
    <p class="status-message">
      Congratulations! Your enrollment is complete. You now have full access to the course materials.
    </p>

    <div class="order-details">
      <div class="detail-row">
        <span class="detail-label">Course</span>
        <span class="detail-value">{{ course.name }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Transaction ID</span>
        <span class="detail-value">{{ transaction_id }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Amount Paid</span>
        <span class="detail-value">‚Çπ{{ total_price|intcomma }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Order ID</span>
        <span class="detail-value">{{ order_id }}</span>
      </div>
    </div>

    <div class="action-buttons">
      <a href="{% url 'my-courses' %}" class="btn-primary-custom">
        <i class="fas fa-graduation-cap"></i> Start Learning
      </a>
    </div>

    <!-- PENDING STATE -->
    {% elif status == 'PENDING' %}
    <div class="status-icon-wrapper">
      <div class="status-icon">
        <i class="fas fa-clock"></i>
      </div>
    </div>

    <h1 class="status-title">Payment Processing</h1>
    <p class="status-message">
      We're processing your payment. This usually takes just a few moments.
    </p>

    <div class="warning-box">
      <h4><i class="fas fa-info-circle" style="color: var(--warning);"></i> Please Note</h4>
      <p>If money has been deducted from your account, please wait 5-10 minutes for the status to update. Do not retry
        the payment.</p>
    </div>

    <div class="order-details">
      <div class="detail-row">
        <span class="detail-label">Course</span>
        <span class="detail-value">{{ course.name }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Order ID</span>
        <span class="detail-value">{{ order_id }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Amount</span>
        <span class="detail-value">‚Çπ{{ total_price|intcomma }}</span>
      </div>
    </div>

    <div class="action-buttons">
      <a href="javascript:window.location.reload();" class="btn-secondary-custom">
        <i class="fas fa-sync-alt"></i> Refresh Status
      </a>
      <a href="{% url 'home' %}" class="btn-secondary-custom">
        <i class="fas fa-home"></i> Go Home
      </a>
    </div>

    <!-- FAILED STATE -->
    {% elif status == 'FAILED' %}
    <div class="status-icon-wrapper">
      <div class="status-icon">
        <i class="fas fa-times"></i>
      </div>
    </div>

    <h1 class="status-title">Payment Failed</h1>
    <p class="status-message">
      Your payment could not be processed. No amount has been deducted from your account.
    </p>

    <div class="order-details">
      <div class="detail-row">
        <span class="detail-label">Course</span>
        <span class="detail-value">{{ course.name }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Amount</span>
        <span class="detail-value">‚Çπ{{ total_price|intcomma }}</span>
      </div>
    </div>

    <div class="action-buttons">
      <a href="{% url 'checkout' course.id %}" class="btn-primary-custom">
        <i class="fas fa-redo"></i> Try Again
      </a>
      <a href="{% url 'contact_us' %}" class="btn-secondary-custom">
        <i class="fas fa-headset"></i> Get Help
      </a>
    </div>

    <!-- ERROR/UNKNOWN STATE -->
    {% else %}
    <div class="status-icon-wrapper">
      <div class="status-icon">
        <i class="fas fa-question-circle"></i>
      </div>
    </div>

    <h1 class="status-title">Unable to Verify Payment</h1>
    <p class="status-message">
      We're having trouble verifying your payment status. Please check your enrolled courses or contact support.
    </p>

    <div class="action-buttons">
      <a href="{% url 'my-courses' %}" class="btn-primary-custom">
        <i class="fas fa-graduation-cap"></i> My Courses
      </a>
      <a href="{% url 'contact_us' %}" class="btn-secondary-custom">
        <i class="fas fa-headset"></i> Contact Support
      </a>
    </div>
    {% endif %}

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Confetti Effect for Success
  {% if status == 'COMPLETED' %}
  function createConfetti() {
    const colors = ['#10b981', '#2563eb', '#f59e0b', '#ef4444', '#8b5cf6'];
    for (let i = 0; i < 50; i++) {
      setTimeout(() => {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        document.body.appendChild(confetti);

        setTimeout(() => confetti.remove(), 3000);
      }, i * 30);
    }
  }

  createConfetti();
  {% endif %}
</script>
{% endblock %}